<UserControl x:Class="EliteInfoPanel.Controls.FleetCarrierCargoCard"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:EliteInfoPanel.ViewModels">

    <!-- Use Grid as root element to enable proper vertical scaling -->
    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Title -->
            <RowDefinition Height="*"/>
            <!-- Scrollable content (will expand to fill space) -->
            <RowDefinition Height="Auto"/>
            <!-- Add new item section -->
            <RowDefinition Height="Auto"/>
            <!-- Status message -->
        </Grid.RowDefinitions>

        <!-- Title - Grid.Row 0 -->
        <TextBlock Text="{Binding Title}" 
                   Style="{StaticResource CardTitleStyle}"
                   Grid.Row="0"
                   Margin="0,0,0,8"/>

        <!-- Cargo List - Grid.Row 1 (will expand to fill space) -->
        <ScrollViewer Grid.Row="1"
                     VerticalScrollBarVisibility="Auto" 
                     HorizontalScrollBarVisibility="Disabled"
                     VerticalAlignment="Stretch" 
                     HorizontalAlignment="Stretch"
                     Margin="0,0,0,8"
                     Background="#11FFFFFF"
                     BorderBrush="#33FFFFFF"
                     BorderThickness="1">
            <ItemsControl ItemsSource="{Binding Cargo}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="0,2,0,2" Padding="4">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Commodity Name - use FontSize binding and set Foreground to white -->
                                <TextBlock Text="{Binding Name}" 
                                           Grid.Column="0" 
                                           VerticalAlignment="Center"
                                           Foreground="White"
                                           TextWrapping="NoWrap"
                                           TextTrimming="CharacterEllipsis"
                                           FontSize="{Binding FontSize}"/>

                                <!-- Quantity - use FontSize binding and set Foreground to white -->
                                <TextBlock Text="{Binding Quantity}" 
                                           Grid.Column="1" 
                                           Margin="8,0,8,0" 
                                           MinWidth="30" 
                                           TextAlignment="Right" 
                                           VerticalAlignment="Center"
                                           Foreground="White"
                                           FontSize="{Binding FontSize}"/>

                                <!-- Adjustment Buttons -->
                                <Button Grid.Column="2" 
                                        Style="{DynamicResource MaterialDesignIconFlatButton}" 
                                        Command="{Binding DataContext.DecrementCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}" 
                                        Width="30" 
                                        Height="30" 
                                        Padding="0" 
                                        Margin="2,0">
                                    <materialDesign:PackIcon Kind="Minus" Height="18" Width="18"/>
                                </Button>

                                <Button Grid.Column="3" 
                                        Style="{DynamicResource MaterialDesignIconFlatButton}"
                                        Command="{Binding DataContext.IncrementCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}" 
                                        Width="30" 
                                        Height="30" 
                                        Padding="0" 
                                        Margin="2,0">
                                    <materialDesign:PackIcon Kind="Plus" Height="18" Width="18"/>
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Add New Section - Grid.Row 2 -->
        <Grid Grid.Row="2" Margin="0,8,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Use FontSize from ViewModel and set proper foreground -->
            <TextBox Grid.Column="0" 
                     materialDesign:HintAssist.Hint="Commodity name" 
                     Text="{Binding NewCommodityName, UpdateSourceTrigger=PropertyChanged}"
                     FontSize="{Binding FontSize}"
                     Foreground="White"
                     Background="#22FFFFFF"/>

            <TextBox Grid.Column="1" 
                     materialDesign:HintAssist.Hint="Qty" 
                     Width="60" 
                     Margin="8,0"
                     Text="{Binding NewCommodityQuantity, UpdateSourceTrigger=PropertyChanged}"
                     FontSize="{Binding FontSize}"
                     Foreground="White"
                     Background="#22FFFFFF"/>

            <Button Grid.Column="2" 
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    Command="{Binding AddCommodityCommand}">
                <materialDesign:PackIcon Kind="Plus"/>
            </Button>
        </Grid>

        <!-- Status Message - Grid.Row 3 -->
        <TextBlock Grid.Row="3"
                   Text="(Tracking live transfers)" 
                   FontStyle="Italic"
                   FontSize="{Binding FontSize, Converter={StaticResource ScaleToFontSizeConverter}, ConverterParameter=0.8}"
                   Foreground="#AAFFFFFF" 
                   Margin="0,6,0,0" 
                   HorizontalAlignment="Right"/>
    </Grid>
</UserControl>